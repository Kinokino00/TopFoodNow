<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org" th:replace="~{layouts/layout :: layout(~{::head}, ~{::body/content}, ~{::body/scripts})}">
<head>
    <title th:text="${pageTitle}">新增推薦</title>
    <style>
        /* CSS for Star Rating */
        .star-rating {
            font-size: 2em; /* Adjust size as needed */
            cursor: pointer;
            color: #ccc; /* Default empty star color */
            display: inline-block; /* Keep stars on one line */
        }
        .star-rating .fa-solid {
            color: gold; /* Filled star color */
        }
        .star-rating .fa-star {
            margin-right: 5px; /* Spacing between stars */
        }
    </style>
</head>
<body>

<th:block th:fragment="content">
    <div class="container mt-4">
        <h2 th:text="${pageTitle}" class="mb-4">新增我的推薦</h2>

        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <form th:action="@{${recommendDTO.userId != null ? '/personal-recommend/edit/' + recommendDTO.storeId : '/personal-recommend/add'}}" th:object="${recommendDTO}" method="post" enctype="multipart/form-data">

            <div class="mb-3">
                <label for="storeName" class="form-label">店家名稱 <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="storeName" name="storeName"
                       th:value="*{storeName}" required>
                <div th:if="${#fields.hasErrors('storeName')}" th:errors="*{storeName}" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label for="storeAddress" class="form-label">店家地址 <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="storeAddress" name="storeAddress"
                       th:value="*{storeAddress}" required>
                <div th:if="${#fields.hasErrors('storeAddress')}" th:errors="*{storeAddress}" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label for="storePhoto" class="form-label">上傳店家圖片 <span class="text-danger">*</span></label>
                <input type="file" class="form-control" id="storePhoto" name="storePhoto" accept="image/*">
                <div th:if="${#fields.hasErrors('storePhoto')}" th:errors="*{storePhoto}" class="text-danger"></div>
            </div>
            <hr>

            <div class="mb-3">
                <label for="reason" class="form-label">推薦理由 <span class="text-danger">*</span></label>
                <textarea class="form-control" id="reason" name="reason" rows="4" th:field="*{reason}" required></textarea>
                <div th:if="${#fields.hasErrors('reason')}" th:errors="*{reason}" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">給店家打幾顆星？ <span class="text-danger">*</span></label>
                <div class="star-rating" id="starRatingContainer">
                    <i class="fa-regular fa-star" data-value="1"></i>
                    <i class="fa-regular fa-star" data-value="2"></i>
                    <i class="fa-regular fa-star" data-value="3"></i>
                    <i class="fa-regular fa-star" data-value="4"></i>
                    <i class="fa-regular fa-star" data-value="5"></i>
                </div>
                <input type="hidden" id="score" name="score" th:field="*{score}">
                <div th:if="${#fields.hasErrors('score')}" th:errors="*{score}" class="text-danger"></div>
            </div>

            <button type="submit" class="btn btn-primary" th:text="${recommendDTO.userId != null ? '更新推薦' : '新增推薦'}">新增推薦</button>
            <a th:href="@{/personal-recommend}" class="btn btn-secondary ms-2">取消</a>
        </form>
    </div>
</th:block>

<th:block th:fragment="scripts">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scoreInput = document.getElementById('score');
            const starRatingContainer = document.getElementById('starRatingContainer');
            const stars = starRatingContainer.querySelectorAll('.fa-star');

            // Function to update star appearance based on a given score
            function updateStars(currentScore) {
                stars.forEach(star => {
                    const starValue = parseInt(star.dataset.value);
                    if (starValue <= currentScore) {
                        star.classList.remove('fa-regular');
                        star.classList.add('fa-solid'); // Filled star
                    } else {
                        star.classList.remove('fa-solid');
                        star.classList.add('fa-regular'); // Empty star
                    }
                });
            }

            // Set initial stars based on existing score (for edit mode)
            const initialScore = parseInt(scoreInput.value) || 0;
            updateStars(initialScore);

            // Add click event listener to each star
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.dataset.value);
                    scoreInput.value = value; // Update hidden input
                    updateStars(value); // Update star appearance
                });

                // Add mouseover event listener for hover effect
                star.addEventListener('mouseover', function() {
                    const hoverValue = parseInt(this.dataset.value);
                    stars.forEach((s) => {
                        const starValue = parseInt(s.dataset.value);
                        if (starValue <= hoverValue) {
                            s.classList.remove('fa-regular');
                            s.classList.add('fa-solid');
                        } else {
                            s.classList.remove('fa-solid');
                            s.classList.add('fa-regular');
                        }
                    });
                });

                // Add mouseout event listener to revert to selected score
                star.addEventListener('mouseout', function() {
                    updateStars(parseInt(scoreInput.value) || 0); // Revert to current selected score
                });
            });
        });
    </script>
</th:block>

</body>
</html>